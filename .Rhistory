## check to see if there is a signal at mz + proton mass with intensity inconsistent with mz  M0 isotope
check2<-which((abs(ramclustObj$fmz - mz - 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
posrange <- c(0.5,1.5)* (ramclustObj$msint[tar[i]]  * ((ramclustObj$fmz[tar[i]] / 14 ) * 0.011))
res2<-any(ramclustObj$msint[check2] > negrange[1] & ramclustObj$msint[check2] < negrange[2] )
} else {res2 <- FALSE}
out[i, "M0_plausible"]<-!any(c(res1, res2))
}
}
}
cat(out)
}
mz
findmass(mz = 591.2811)
#' findmass
#'
#' see if any features match a given mass, and whether they are plausibly M0
#' @param ramclustObj - the ramclustR object to explore
#' @param mz - numeric mz value to search for
#' @param mztol - absolute mass tolerance around mz
#' @param rttol - when examining isotope patterns, feaure retention time tolerance around features matching mz +- mztol
#' @param m.check - logical - check whether the matching masses are plausibly M0.  Looks for ions above and below the target m/z at the same time that have intensities consistent with target ion being a non-M0 isotope.
#'#' @export
findmass<-function(
ramclustObj = RC,
mz = NULL,
mztol = 0.02,
rttol = 2,
m.check = TRUE
) {
if(is.null(mz)) {stop("must set 'mz'", '\n')}
if(is.null(mztol)) {stop("must set 'mztol'", '\n')}
tar<-which(abs(ramclustObj$fmz - mz) <= mztol)
if(length (tar)==0) {
stop("no masses found within", mztol, "mz units of", mz, '\n')
} else {
out<-data.frame("featn" = tar,
"featclus" = ramclustObj$featclus[tar],
"mz" = ramclustObj$fmz[tar],
"rt" = ramclustObj$frt[tar],
"int" = ramclustObj$msint[tar],
"M0_plausible" = rep(NA, length(tar))
)
if(m.check) {
for(i in 1:length(tar)) {
## check to see if there is a signal at mz - proton mass with intensity inconsistent with mz  M0 isotope
check1<-which((abs(ramclustObj$fmz - mz + 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
negrange <- c(0.5,1.5)* (ramclustObj$msint[tar[i]]  / ((ramclustObj$fmz[tar[i]] / 14 ) * 0.011))
res1<-any(ramclustObj$msint[check1] > negrange[1] & ramclustObj$msint[check1] < negrange[2] )
} else {res1 <- FALSE}
## check to see if there is a signal at mz + proton mass with intensity inconsistent with mz  M0 isotope
check2<-which((abs(ramclustObj$fmz - mz - 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
posrange <- c(0.5,1.5)* (ramclustObj$msint[tar[i]]  * ((ramclustObj$fmz[tar[i]] / 14 ) * 0.011))
res2<-any(ramclustObj$msint[check2] > negrange[1] & ramclustObj$msint[check2] < negrange[2] )
} else {res2 <- FALSE}
out[i, "M0_plausible"]<-!any(c(res1, res2))
}
}
}
print(out)
}
findmass(mz = 591.2811)
#' findmass
#'
#' see if any features match a given mass, and whether they are plausibly M0
#' @param ramclustObj - the ramclustR object to explore
#' @param mz - numeric mz value to search for
#' @param mztol - absolute mass tolerance around mz
#' @param rttol - when examining isotope patterns, feaure retention time tolerance around features matching mz +- mztol
#' @param m.check - logical - check whether the matching masses are plausibly M0.  Looks for ions above and below the target m/z at the same time that have intensities consistent with target ion being a non-M0 isotope.
#' @return returns a table to the console listing masses which match, their retention time and intensity, and whether it appears to be plausible as M0
#'#' @export
findmass<-function(
ramclustObj = RC,
mz = NULL,
mztol = 0.02,
rttol = 2,
m.check = TRUE
) {
if(is.null(mz)) {stop("must set 'mz'", '\n')}
if(is.null(mztol)) {stop("must set 'mztol'", '\n')}
tar<-which(abs(ramclustObj$fmz - mz) <= mztol)
if(length (tar)==0) {
stop("no masses found within", mztol, "mz units of", mz, '\n')
} else {
out<-data.frame("featn" = tar,
"featclus" = ramclustObj$featclus[tar],
"mz" = ramclustObj$fmz[tar],
"rt" = ramclustObj$frt[tar],
"int" = ramclustObj$msint[tar],
"M0_plausible" = rep(NA, length(tar))
)
if(m.check) {
for(i in 1:length(tar)) {
## check to see if there is a signal at mz - proton mass with intensity inconsistent with mz  M0 isotope
check1<-which((abs(ramclustObj$fmz - mz + 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
negrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  / ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
res1<-any(ramclustObj$msint[check1] > negrange[1] & ramclustObj$msint[check1] < negrange[2] )
} else {res1 <- FALSE}
## check to see if there is a signal at mz + proton mass with intensity inconsistent with mz  M0 isotope
check2<-which((abs(ramclustObj$fmz - mz - 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
posrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  * ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
res2<-any(ramclustObj$msint[check2] > negrange[1] & ramclustObj$msint[check2] < negrange[2] )
} else {res2 <- FALSE}
out[i, "M0_plausible"]<-!any(c(res1, res2))
}
}
}
print(out)
}
findmass(mz = 591.2811)
roxygen2::roxygenise()
roxygen2::roxygenise()
install_github("cbroeckl/RAMClustR", build_vignettes = TRUE)
devtools::install_github("cbroeckl/RAMClustR", build_vignettes = TRUE)
?findmass
library(RAMClustR)
?findmass
roxygen2::roxygenise()
roxygen2::roxygenise()
devtools::install_github('cbroeckl/ramclustR', build_vignette = TRUE)
detatch('package:RAMClustR')
detach('package:RAMClustR')
library(RAMClustR)
?findmass
library(RAMClustR)
?findmass
?ramclustR
??ramclustR
source('~/GitHub/RAMClustR/R/ramclustR.R')
source('~/GitHub/RAMClustR/R/do.findmain.R', encoding = 'UTF-8')
source('~/GitHub/RAMClustR/R/Params.R')
roxygen2::roxygenise()
devools::install_github('cbroeckl/RAMClustR', build_vignette = TRUE)
devtools::install_github('cbroeckl/RAMClustR', build_vignette = TRUE)
mz
ramclustObj$fmz[86]
library(xcms)
library(faahKO)
cdfpath <- system.file("cdf", package = "faahKO")
cdffiles <- list.files(cdfpath, recursive = TRUE, full.names = TRUE)
xset <- xcmsSet(cdffiles)  # detect features
xset <- group(xset)  # group features across samples by retention time and mass
xset <- retcor(xset, family = "symmetric", plottype = NULL)  # correct for drive in retention time
xset <- group(xset, bw = 10)  # regroup following rt correction
xset <- fillPeaks(xset)  # 'fillPeaks' to remove missing values in final dataset
xset
experiment <- defineExperiment(force.skip = TRUE)
RC <- ramclustR(xcmsObj = xset, ExpDes=experiment)
RC$fmz[86:87]
RC$fmz[85:87]
RC$fmz[85:89]
#' findmass
#'
#' see if any features match a given mass, and whether they are plausibly M0
#'  @details  a convenience function to perform a targeted search of all feaures for a mass of interest.  Also performs a crude plausibility check as to whether the matched feature could be M0, based on the assumption of approximately 1 carbon per 17 m/z units and natural isottopic abundance of 1.1% 13C
#'
#' @param ramclustObj - the ramclustR object to explore
#' @param mz - numeric mz value to search for
#' @param mztol - absolute mass tolerance around mz
#' @param rttol - when examining isotope patterns, feaure retention time tolerance around features matching mz +- mztol
#' @param m.check - logical - check whether the matching masses are plausibly M0.  Looks for ions above and below the target m/z at the same time that have intensities consistent with target ion being a non-M0 isotope.
#' @return returns a table to the console listing masses which match, their retention time and intensity, and whether it appears to be plausible as M0
#' @keywords 'ramclustR' 'RAMClustR', 'ramclustR', 'metabolomics', 'mass spectrometry', 'clustering', 'feature', 'xcms'
#' @author Corey Broeckling
#' @export
findmass<-function(
ramclustObj = RC,
mz = NULL,
mztol = 0.02,
rttol = 2,
m.check = TRUE
) {
if(is.null(mz)) {stop("must set 'mz'", '\n')}
if(is.null(mztol)) {stop("must set 'mztol'", '\n')}
tar<-which(abs(ramclustObj$fmz - mz) <= mztol)
if(length (tar)==0) {
stop("no masses found within", mztol, "mz units of", mz, '\n')
} else {
out<-data.frame("featn" = tar,
"featclus" = ramclustObj$featclus[tar],
"mz" = ramclustObj$fmz[tar],
"rt" = ramclustObj$frt[tar],
"int" = ramclustObj$msint[tar],
"M0_plausible" = rep(NA, length(tar))
)
if(m.check) {
for(i in 1:length(tar)) {
## check to see if there is a signal at mz - proton mass with intensity inconsistent with mz  M0 isotope
check1<-which((abs(ramclustObj$fmz - mz + 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
negrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  / ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
res1<-any(ramclustObj$msint[check1] > negrange[1] & ramclustObj$msint[check1] < negrange[2] )
} else {res1 <- FALSE}
## check to see if there is a signal at mz + proton mass with intensity inconsistent with mz  M0 isotope
check2<-which((abs(ramclustObj$fmz - mz - 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
posrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  * ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
res2<-any(ramclustObj$msint[check2] > negrange[1] & ramclustObj$msint[check2] < negrange[2] )
} else {res2 <- FALSE}
out[i, "M0_plausible"]<-!any(c(res1, res2))
}
}
}
print(out)
}
findmass(mz = RC$fmz[87])
findmass(mz = RC$fmz[86])
#' findmass
#'
#' see if any features match a given mass, and whether they are plausibly M0
#'  @details  a convenience function to perform a targeted search of all feaures for a mass of interest.  Also performs a crude plausibility check as to whether the matched feature could be M0, based on the assumption of approximately 1 carbon per 17 m/z units and natural isottopic abundance of 1.1% 13C
#'
#' @param ramclustObj - the ramclustR object to explore
#' @param mz - numeric mz value to search for
#' @param mztol - absolute mass tolerance around mz
#' @param rttol - when examining isotope patterns, feaure retention time tolerance around features matching mz +- mztol
#' @param m.check - logical - check whether the matching masses are plausibly M0.  Looks for ions above and below the target m/z at the same time that have intensities consistent with target ion being a non-M0 isotope.
#' @return returns a table to the console listing masses which match, their retention time and intensity, and whether it appears to be plausible as M0
#' @keywords 'ramclustR' 'RAMClustR', 'ramclustR', 'metabolomics', 'mass spectrometry', 'clustering', 'feature', 'xcms'
#' @author Corey Broeckling
#' @export
findmass<-function(
ramclustObj = RC,
mz = NULL,
mztol = 0.02,
rttol = 2,
m.check = TRUE
) {
if(is.null(mz)) {stop("must set 'mz'", '\n')}
if(is.null(mztol)) {stop("must set 'mztol'", '\n')}
tar<-which(abs(ramclustObj$fmz - mz) <= mztol)
if(length (tar)==0) {
stop("no masses found within", mztol, "mz units of", mz, '\n')
} else {
out<-data.frame("featn" = tar,
"featclus" = ramclustObj$featclus[tar],
"mz" = ramclustObj$fmz[tar],
"rt" = ramclustObj$frt[tar],
"int" = ramclustObj$msint[tar],
"M0_plausible" = rep(NA, length(tar))
)
if(m.check) {
for(i in 1:length(tar)) {
## check to see if there is a signal at mz - proton mass with intensity inconsistent with mz  M0 isotope
check1<-which((abs(ramclustObj$fmz - mz + 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
negrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  / ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
res1<-any(ramclustObj$msint[check1] > negrange[1] & ramclustObj$msint[check1] < negrange[2] )
} else {res1 <- FALSE}
## check to see if there is a signal at mz + proton mass with intensity inconsistent with mz  M0 isotope
# check2<-which((abs(ramclustObj$fmz - mz - 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
# if(length(check1)>0) {
#   posrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  * ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
#   res2<-any(ramclustObj$msint[check2] > negrange[1] & ramclustObj$msint[check2] < negrange[2] )
# } else {res2 <- FALSE}
out[i, "M0_plausible"]<-!res1
}
}
}
print(out)
}
findmass(mz = RC$fmz[87])
findmass(mz = RC$fmz[86])
#' findmass
#'
#' see if any features match a given mass, and whether they are plausibly M0
#'  @details  a convenience function to perform a targeted search of all feaures for a mass of interest.  Also performs a crude plausibility check as to whether the matched feature could be M0, based on the assumption of approximately 1 carbon per 17 m/z units and natural isottopic abundance of 1.1% 13C
#'
#' @param ramclustObj - the ramclustR object to explore
#' @param mz - numeric mz value to search for
#' @param mztol - absolute mass tolerance around mz
#' @param rttol - when examining isotope patterns, feaure retention time tolerance around features matching mz +- mztol
#' @param m.check - logical - check whether the matching masses are plausibly M0.  Looks for ions above and below the target m/z at the same time that have intensities consistent with target ion being a non-M0 isotope.
#' @return returns a table to the console listing masses which match, their retention time and intensity, and whether it appears to be plausible as M0
#' @keywords 'ramclustR' 'RAMClustR', 'ramclustR', 'metabolomics', 'mass spectrometry', 'clustering', 'feature', 'xcms'
#' @author Corey Broeckling
#' @export
findmass<-function(
ramclustObj = RC,
mz = NULL,
mztol = 0.02,
rttol = 2,
m.check = TRUE
) {
if(is.null(mz)) {stop("must set 'mz'", '\n')}
if(is.null(mztol)) {stop("must set 'mztol'", '\n')}
tar<-which(abs(ramclustObj$fmz - mz) <= mztol)
if(length (tar)==0) {
stop("no masses found within", mztol, "mz units of", mz, '\n')
} else {
out<-data.frame("featn" = tar,
"featclus" = ramclustObj$featclus[tar],
"mz" = ramclustObj$fmz[tar],
"rt" = ramclustObj$frt[tar],
"int" = ramclustObj$msint[tar],
"M0_plausible" = rep(NA, length(tar))
)
if(m.check) {
for(i in 1:length(tar)) {
## check to see if there is a signal at mz - proton mass with intensity inconsistent with mz  M0 isotope
check1<-which((abs(ramclustObj$fmz - mz + 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
if(length(check1)>0) {
negrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  / ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
out[i, "M0_plausible"]<-!any(ramclustObj$msint[check1] > negrange[1] & ramclustObj$msint[check1] < negrange[2] )
} else {out[i, "M0_plausible"] <- TRUE}
## check to see if there is a signal at mz + proton mass with intensity inconsistent with mz  M0 isotope
# check2<-which((abs(ramclustObj$fmz - mz - 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
# if(length(check1)>0) {
#   posrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  * ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
#   res2<-any(ramclustObj$msint[check2] > negrange[1] & ramclustObj$msint[check2] < negrange[2] )
# } else {res2 <- FALSE}
#out[i, "M0_plausible"]<-!res1
}
}
}
print(out)
}
findmass(mz = RC$fmz[87])
findmass(mz = RC$fmz[86])
unique(1:4, 3:7)
unique(c(1:4, 3:7))
findmass<-function(
ramclustObj = RC,
mz = NULL,
mztol = 0.02,
rttol = 2,
zmax = 6,
m.check = TRUE
) {
if(is.null(mz)) {stop("must set 'mz'", '\n')}
if(is.null(mztol)) {stop("must set 'mztol'", '\n')}
tar<-which(abs(ramclustObj$fmz - mz) <= mztol)
if(length (tar)==0) {
stop("no masses found within", mztol, "mz units of", mz, '\n')
} else {
out<-data.frame("featn" = tar,
"featclus" = ramclustObj$featclus[tar],
"mz" = ramclustObj$fmz[tar],
"rt" = ramclustObj$frt[tar],
"int" = ramclustObj$msint[tar],
"M0_plausible" = rep(NA, length(tar))
)
if(m.check) {
for(i in 1:length(tar)) {
## check to see if there is a signal at mz - proton mass with intensity inconsistent with mz  M0 isotope
check <- vector()
for(j in 1:zmax) {
check1<-which((abs(ramclustObj$fmz - mz + 1.007276) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
check<-unique(c(check, check1))
}
if(length(check)>0) {
negrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  / ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
out[i, "M0_plausible"]<-!any(ramclustObj$msint[check] > negrange[1] & ramclustObj$msint[check] < negrange[2] )
} else {out[i, "M0_plausible"] <- TRUE}
## check to see if there is a signal at mz + proton mass with intensity inconsistent with mz  M0 isotope
# check2<-which((abs(ramclustObj$fmz - mz - 1.0078) <= mztol) & (abs(ramclustObj$frt - ramclustObj$frt[tar[i]]) <= rttol ))
# if(length(check1)>0) {
#   posrange <- c(0.5,2)* (ramclustObj$msint[tar[i]]  * ((ramclustObj$fmz[tar[i]] / 17 ) * 0.011))
#   res2<-any(ramclustObj$msint[check2] > negrange[1] & ramclustObj$msint[check2] < negrange[2] )
# } else {res2 <- FALSE}
#out[i, "M0_plausible"]<-!res1
}
}
}
print(out)
}
findmass(mz = RC$fmz[87])
findmass(mz = RC$fmz[86])
source('~/GitHub/RAMClustR/R/ramclustR.R')
source('~/GitHub/RAMClustR/R/do.findmain.R', encoding = 'UTF-8')
roxygen2::roxygenise()
source('~/GitHub/RAMClustR/R/ramclustR.R')
source('~/GitHub/RAMClustR/R/do.findmain.R', encoding = 'UTF-8')
source('~/GitHub/RAMClustR/R/Params.R')
RC <- do.findmain(RC, mode = "positive", mzabs.error = 0.02, ppm.error = 10)
devtools::install_github("cbroeckl/RAMClustR", build_vignettes = TRUE)
?findmass
ramclustObj = RC
mat.dir = NULL
mat.dir = NULL
rt.form.filter = TRUE
if(rt.form.filter) {
library(CHNOSZ)
}
install.packages("CHNOSZ")
if(rt.form.filter) {
require(CHNOSZ)
}
if(is.null(mat.dir)) {
mat.dir = paste0(getwd(), "/spectra/mat")
}
if(!dir.exists(mat.dir)) {
stop(paste("there is no directory called:", '\n', getwd()))
}
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
#' do.msfinder.formula
#'
#' Call MSFinder from R.  Currently requires clunky pasting into cmd prompt.
#' @param msfinder.dir full path to the directory containing the MSFinderConsoleApp exe file
#' @param mat.dir by default, ramclustR will look in the working directory for a spectra/mat or spectra/msp subdirectory.  Else specify the path here for mat formatted spectra (all spectra in directory will be used)
#' @param msp.idr by default, ramclustR will look in the working directory for a spectra/mat or spectra/msp subdirectory.  Else specify the path here for msp formatted spectra (all spectra in directory will be used)
#' @details calls the 'MsfinderConsoleApp.exe' 'predict' program.  Ensure before calling that you have set appropriate parameters in the 'MSFINDER.INI' file
#' @return nothing is returned.  data can be imported using the import.MSFinder.formulas() and import.MSFinder.formulas.R(structure) commands after processing has finished
#' @references Broeckling CD, Afsar FA, Neumann S, Ben-Hur A, Prenni JE. RAMClust: a novel feature clustering method enables spectral-matching-based annotation for metabolomics data. Anal Chem. 2014 Jul 15;86(14):6812-7. doi: 10.1021/ac501530d.  Epub 2014 Jun 26. PubMed PMID: 24927477.
#' @references Broeckling CD, Ganna A, Layer M, Brown K, Sutton B, Ingelsson E, Peers G, Prenni JE. Enabling Efficient and Confident Annotation of LC-MS Metabolomics Data through MS1 Spectrum and Time Prediction. Anal Chem. 2016 Sep 20;88(18):9226-34. doi: 10.1021/acs.analchem.6b02479. Epub 2016 Sep 8. PubMed PMID: 7560453.
#' @references Tsugawa H, Kind T, Nakabayashi R, Yukihira D, Tanaka W, Cajka T, Saito K, Fiehn O, Arita M. Hydrogen Rearrangement Rules: Computational MS/MS Fragmentation and Structure Elucidation Using MS-FINDER Software. Anal Chem. 2016 Aug 16;88(16):7946-58. doi: 10.1021/acs.analchem.6b00770. Epub 2016 Aug 4. PubMed PMID: 27419259.
#' @keywords 'ramclustR' 'RAMClustR', 'ramclustR', 'metabolomics', 'mass spectrometry', 'clustering', 'feature', 'xcms'
#' @author Corey Broeckling
#'
do.msfinder.formula <- function(
msfinder.dir = "K:/software/MSFinder/MS-FINDER program ver. 2.20",
mat.dir = NULL,
msp.dir = NULL
) {
if(is.null(msfinder.dir)) {
choose.dir(caption = "Select directory containing MS-Finder program")
}
if(is.null(mat.dir)) {
mat.dir = paste0(getwd(), "/spectra/mat")
}
if(is.null(msp.dir)) {
msp.dir = paste0(getwd(), "/spectra/msp")
}
usemat = TRUE
usemsp = TRUE
if(!dir.exists(mat.dir)) {
usemat = FALSE
}
if(!dir.exists(msp.dir)) {
usemsp = FALSE
}
if(!usemsp & !usemat) {
stop("neither of these two directories exist: ", '\n',
"  ", mat.dir, '\n',
"  ", msp.dir, '\n')
}
if(usemsp & usemat) {
msps<-list.files(msp.dir, recursive  = TRUE)
mats<-list.files(mat.dir, recursive = TRUE)
if(length(mats) > length(msps)) {usemsp <- FALSE}
if(length(msps) > length(mats)) {usemat <- FALSE}
if(length(msps) == length(mats)) {
feedback<-readline(prompt="Press 1 for .mat or 2 for .msp to continue")
if(feedback == 1) {usemsp <- FALSE}
if(feedback == 2) {usemat <- FALSE}
}
}
mat.dir <- c(mat.dir, msp.dir)[c(usemat, usemsp)]
# MsfinderConsoleApp.exe  predict -i .\test\ -o .\test\ -m .\MsfinderConsoleApp.exe.config
progname<-"MsfinderConsoleApp.exe"
# THIS WORKS if you copy the full string from the 'cmd.txt' file and paste into cmd console
cmdString<-paste(
paste0('"', normalizePath( paste0(msfinder.dir, "/", progname), winslash="\\"), '"'),
"predict -i",
paste0('"', normalizePath(mat.dir, winslash = "\\"), '"'),
"-o",
paste0('"', normalizePath(mat.dir, winslash = "\\"), '"'),
"-m",
paste0('"', normalizePath( paste0(msfinder.dir, "/", "MsfinderConsoleApp.exe.config"), winslash="\\"), '"')
)
# write(cmdString, file="cmd.txt")
writeClipboard(cmdString)
cat(" please: ",'\n',
"   open the command prompt", '\n',
"   right click on command prompt background", '\n',
"   click 'paste'", '\n',
"   hit 'enter' on keyboard", '\n', '\n',
"once cmd prompt indicates that process has finished you may import results")
# wd<-getwd()
# setwd(normalizePath(msfinder.dir, winslash = "\\"))
#
# cmdString<-paste(
#   paste0('"', normalizePath( paste0(msfinder.dir, "/", progname), winslash="\\"), '"'),
#   "predict -i",
#   paste0('"', normalizePath(mat.dir, winslash = "\\"), '"'),
#   "-o",
#   paste0('"', normalizePath(mat.dir, winslash = "\\"), '"'),
#   "-m",
#   paste0('"', normalizePath( paste0(msfinder.dir, "/", "MsfinderConsoleApp.exe.config"), winslash="\\"), '"')
# )
#
# shell(cmdString, shell = NULL, flag = "-c", intern = TRUE, translate = TRUE, minimized = FALSE)
#
#
#
# system(cmdString)
#
# shell(cmdString, translate = TRUE)
# setwd(wd)
#
#
#
# prog<-shQuote(normalizePath(paste0(msfinder.dir, "/", progname), winslash="\\"))
# opt<-c(
#   " predict ",
#   paste(" -i",  shQuote(normalizePath(mat.dir, winslash="\\"))),
#   paste(" -o", shQuote(normalizePath(mat.dir, winslash="\\"))),
#   paste(" -m",  (normalizePath(paste0(msfinder.dir, "/", "MsfinderConsoleApp.exe.config"), winslash="\\")))
#       )
# system2(command = prog, args = opt)
#
}
roxygen2::roxygenise()
roxygen2::roxygenise()
